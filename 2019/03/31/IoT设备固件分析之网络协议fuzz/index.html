<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="0d4t_hprsM6xsQKeGeYaBnGc8q8SZms2YKwT0JV7R1A"><meta name="msvalidate.01" content="FC470CF968AE82F56A6EF54706074EF7"><meta name="baidu-site-verification" content="yFjlb3QBTm"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@2.1.6/source/jquery.fancybox.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"cq674350529.github.io",root:"/",scheme:"Mist",version:"7.8.0",exturl:!0,sidebar:{position:"right",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言 通常，在对IoT设备的固件进行分析时，固件中与提供服务如HTTP、Telnet、RTSP、UPnP等相关的二进制程序是重点分析的对象。因为一旦在这些程序中发现漏洞，其很有可能会被远程利用，进而带来严重的安全隐患。 对固件二进制程序进行分析，常见的分析方法包括模糊测试、补丁比对、工具静态扫描和人工审计等。其中，模糊测试方法具备简单易用的特点，通常也比较有效，其在业界已被广泛使用。"><meta property="og:type" content="article"><meta property="og:title" content="IoT设备固件分析之网络协议fuzz"><meta property="og:url" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/index.html"><meta property="og:site_name" content="cq674350529&#39;s blog"><meta property="og:description" content="前言 通常，在对IoT设备的固件进行分析时，固件中与提供服务如HTTP、Telnet、RTSP、UPnP等相关的二进制程序是重点分析的对象。因为一旦在这些程序中发现漏洞，其很有可能会被远程利用，进而带来严重的安全隐患。 对固件二进制程序进行分析，常见的分析方法包括模糊测试、补丁比对、工具静态扫描和人工审计等。其中，模糊测试方法具备简单易用的特点，通常也比较有效，其在业界已被广泛使用。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/模糊测试基本流程.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/模糊测试工具与方法对应关系.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/boofuzz_framework.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/session_graph.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/wireshark_requests.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/session_graph_example.png"><meta property="og:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/boofuzz_webinterface.png"><meta property="article:published_time" content="2019-03-31T02:00:00.000Z"><meta property="article:modified_time" content="2020-08-12T13:51:26.000Z"><meta property="article:author" content="cq674350529"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/images/模糊测试基本流程.png"><link rel="canonical" href="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>IoT设备固件分析之网络协议fuzz | cq674350529's blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="cq674350529's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">cq674350529's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar_64.jpg"><meta itemprop="name" content="cq674350529"><meta itemprop="description" content="Talk is cheap. Show me the code."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="cq674350529's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">IoT设备固件分析之网络协议fuzz</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-31 10:00:00" itemprop="dateCreated datePublished" datetime="2019-03-31T10:00:00+08:00">2019-03-31</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-08-12 21:51:26" itemprop="dateModified" datetime="2020-08-12T21:51:26+08:00">2020-08-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/IoT/" itemprop="url" rel="index"><span itemprop="name">IoT</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/fuzz/" itemprop="url" rel="index"><span itemprop="name">fuzz</span></a> </span></span><span id="/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/" class="post-meta-item leancloud_visitors" data-flag-title="IoT设备固件分析之网络协议fuzz" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>通常，在对<code>IoT</code>设备的固件进行分析时，固件中与提供服务如<code>HTTP</code>、<code>Telnet</code>、<code>RTSP</code>、<code>UPnP</code>等相关的二进制程序是重点分析的对象。因为一旦在这些程序中发现漏洞，其很有可能会被远程利用，进而带来严重的安全隐患。</p><p>对固件二进制程序进行分析，常见的分析方法包括<strong>模糊测试</strong>、<strong>补丁比对</strong>、<strong>工具静态扫描</strong>和<strong>人工审计</strong>等。其中，模糊测试方法具备简单易用的特点，通常也比较有效，其在业界已被广泛使用。</p><a id="more"></a><p>下面，以某型号路由器为例，基于<a target="_blank" rel="noopener" href="https://github.com/jtpereyda/boofuzz"><code>Boofuzz</code></a>框架，介绍对常见网络协议进行<code>fuzz</code>的方法。</p><blockquote><p>除了网络协议外，也可以采用类似的思路对其他协议如<code>BLE</code>、串口协议等进行<code>fuzz</code>。同时，该方法不仅局限于<code>IoT</code>设备，也可用于对常见的服务程序进行测试。</p></blockquote><h3 id="模糊测试简介"><a href="#模糊测试简介" class="headerlink" title="模糊测试简介"></a>模糊测试简介</h3><p><strong>模糊测试</strong>采用黑盒测试的思想，通过构造大量的畸形数据作为应用程序的输入，来发现程序中可能存在的安全缺陷或漏洞。</p><img data-src="images/模糊测试基本流程.png"><p>模糊测试方法的分类有很多。根据测试用例生成方式的不同，可以分为基于<strong>变异</strong>的模糊测试和基于<strong>生成</strong>的模糊测试。根据对目标程序的理解程度，可分为<strong>黑盒</strong>模糊测试、<strong>灰盒</strong>模糊测试和<strong>白盒</strong>模糊测试。常见工具与方法的对应关系如下。</p><img data-src="images/模糊测试工具与方法对应关系.png" style="zoom:60%"><p>针对<code>IoT</code>设备，由于其资源受限和环境受限等特点，实际中常采用黑盒模糊测试的方式。在对网络协议进行测试时，可以将常见的网络协议分为两类：一类属于<strong>文本协议</strong>，如<code>HTTP</code>、<code>FTP</code>等，这类协议的特点是其数据包内容都是可见字符；另一类为<strong>二进制协议</strong>，其特点是数据包内容大部分是不可见字符，这类协议在工控设备如<code>PLC</code>中比较常见，通常属于私有协议。针对文本协议，笔者常采用<a target="_blank" rel="noopener" href="https://github.com/OpenRCE/sulley"><code>Sulley</code></a>框架进行测试；而针对二进制协议，则常采用<a target="_blank" rel="noopener" href="https://github.com/cisco-sas/kitty"><code>kitty</code></a>框架进行测试。</p><blockquote><p><code>Sulley</code>框架和<code>kitty</code>框架均能够对两类协议进行测试。</p></blockquote><p>另外，在对<code>IoT</code>设备进行模糊测试时，需要考虑如何对设备进行监控，以判断是否出现异常。最简单的方式通过设备服务的可用性进行判断，如果设备提供的服务不可访问，表明设备可能崩溃了。但这种监控方式粒度比较粗，容易漏掉一些异常行为。另外，当设备出现异常后，还需要对环境进行恢复，以便继续进行测试。常见的方式就是重启设备。现在很多设备崩溃之后都会自动重启，如果测试目标设备没用提供这种机制，则需要采用其他方式解决。</p><h3 id="Boofuzz框架简介"><a href="#Boofuzz框架简介" class="headerlink" title="Boofuzz框架简介"></a><code>Boofuzz</code>框架简介</h3><p>由于<code>Sulley</code>框架目前已经停止更新维护，而<a target="_blank" rel="noopener" href="https://github.com/jtpereyda/boofuzz"><code>Boofuzz</code></a>框架是<code>Sulley</code>的继承者，除了修复一些<code>bug</code>之外，还增加了框架的可扩展性。下面对<code>Boofuzz</code>框架进行简单介绍。</p><img data-src="images/boofuzz_framework.png" style="zoom:60%"><blockquote><p>来源: Fuzzing Sucks! Introducing the sulley fuzzing framework. Pedram Amini &amp; Aaron Portnoy. Black Hat US 2007</p></blockquote><p>由上图可知，该框架主要包含四个部分：</p><ul><li><p><code>数据生成</code>：根据协议格式利用原语来构造<code>请求</code></p></li><li><p><code>会话管理/驱动</code>：将<code>请求</code>以图的形式链接起来形成会话，同时管理<code>待测目标</code>、<code>代理</code>、<code>请求</code>，还提供一个web界面用于监视和控制</p></li><li><p><code>代理</code>：与目标进行交互以实现日志记录、对网络流量进行监控等</p><blockquote><p>通常，<code>代理</code>是运行在目标设备上。但是，对于<code>IoT</code>设备而言，大部分情况下都无法在目标设备上运行代理程序。</p></blockquote></li><li><p><code>实用工具</code>：独立的命令行工具，完成一些其他的功能</p></li></ul><p>其中，<code>数据生成</code>和<code>会话管理/驱动</code>是比较重要的2个模块。对于<code>数据生成</code>模块，<code>Boofuzz</code>框架提供了很多原语来定义<code>请求</code>，如最基础的<code>s_string()</code>、<code>s_byte()</code>、<code>s_static()</code>等。对于<code>会话管理/驱动</code>模块，其思想体现在下图中。</p><img data-src="images/session_graph.png"><blockquote><p>来源: Fuzzing Sucks! Introducing the sulley fuzzing framework. Pedram Amini &amp; Aaron Portnoy. Black Hat US 2007</p></blockquote><p>在上图中，节点<code>ehlo</code>、<code>helo</code>、<code>mail from</code>、<code>rcpt to</code>、<code>data</code>表示5个<code>请求</code>，路径<code>&#39;ehlo&#39;-&gt;&#39;mail form&#39;-&gt;&#39;rcpt to&#39;-&gt;&#39;data&#39;</code>和<code>&#39;helo&#39;-&gt;&#39;mail from&#39;-&gt;&#39;rcpt to&#39;-&gt;data&#39;</code>体现了<code>请求</code>之间的先后顺序关系。<code>callback_one()</code>和<code>callback_two()</code>表示回调函数，当从节点<code>echo</code>移动到节点<code>mail from</code>时会触发该回调函数，利用这一机制，节点<code>mail from</code>可以获取节点<code>ehlo</code>中的一些信息。而<code>pre_send()</code>和<code>post_send()</code>则负责测试前的一些预处理工作和测试后的一些清理工作。</p><p>理解了这几个模块的功能后，使用该框架进行测试的主要步骤如下：</p><ol><li>根据网络数据包构造<code>请求</code>；</li><li>设置会话信息(包括测试目标的<code>ip</code>地址和端口等)，然后按照请求的先后顺序将其链接起来；</li><li>添加对目标设备的监控和设备重启机制等；</li><li>开始<code>fuzz</code>。</li></ol><h3 id="协议fuzz实战"><a href="#协议fuzz实战" class="headerlink" title="协议fuzz实战"></a>协议<code>fuzz</code>实战</h3><p>以某型号路由器为例，由于路由器上<code>HTTP</code>服务是最为常见的，故以<code>http</code>协议为例进行介绍。</p><blockquote><p>模糊测试属于动态分析技术，因此需要有真实设备，或者采用对固件进行仿真的方式。</p></blockquote><h4 id="根据网络数据包构造请求"><a href="#根据网络数据包构造请求" class="headerlink" title="根据网络数据包构造请求"></a>根据网络数据包构造请求</h4><p>首先，需要尽可能多地与设备进行交互，然后捕获相应的<code>http</code>请求数据包，如下。</p><img data-src="images/wireshark_requests.png"><p>以登录请求为例，对应的<code>http</code>请求报文示例如下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;HNAP1&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 400</span><br><span class="line">HNAP_AUTH: E889FD5249E5D51C6C9424283DE3B5DB 1553349899</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;72.0.3626.121 Safari&#x2F;537.36</span><br><span class="line">Content-Type: text&#x2F;xml; charset&#x3D;UTF-8</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">SOAPAction: &quot;http:&#x2F;&#x2F;purenetworks.com&#x2F;HNAP1&#x2F;Login&quot;</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,en;q&#x3D;0.8</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xmlns:xsd&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema&quot; xmlns:soap&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot;&gt;&lt;soap:Body&gt;&lt;Login xmlns&#x3D;&quot;http:&#x2F;&#x2F;purenetworks.com&#x2F;HNAP1&#x2F;&quot;&gt;&lt;Action&gt;request&lt;&#x2F;Action&gt;&lt;Username&gt;xxx&lt;&#x2F;Username&gt;&lt;LoginPassword&gt;xxx&lt;&#x2F;LoginPassword&gt;&lt;Captcha&gt;&lt;&#x2F;Captcha&gt;&lt;&#x2F;Login&gt;&lt;&#x2F;soap:Body&gt;&lt;&#x2F;soap:Envelope&gt;</span><br></pre></td></tr></table></figure><p>利用该框架中提供的原语对<code>http</code>请求进行定义，部分示例如下。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">s_initialize(<span class="string">&#x27;login&#x27;</span>)	<span class="comment"># 整个请求的名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应 POST /HNAP1/ HTTP/1.1</span></span><br><span class="line">s_string(<span class="string">&#x27;POST&#x27;</span>, name=<span class="string">&#x27;method&#x27;</span>)		<span class="comment"># 对该字段进行fuzz</span></span><br><span class="line">s_static(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">s_static(<span class="string">&#x27;/HNAP1/&#x27;</span>, name=<span class="string">&#x27;url&#x27;</span>)		<span class="comment"># 不对该字段进行fuzz</span></span><br><span class="line">s_static(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">s_static(<span class="string">&#x27;HTTP/1.1&#x27;</span>)</span><br><span class="line">s_static(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应 Content-Length: 400</span></span><br><span class="line">s_static(<span class="string">&#x27;Content-Length&#x27;</span>)</span><br><span class="line">s_static(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">s_size(<span class="string">&#x27;data&#x27;</span>, output_format=<span class="string">&#x27;ascii&#x27;</span>, fuzzable=<span class="literal">True</span>)	<span class="comment"># size的值根据data部分的长度自动进行计算，同时对该字段进行fuzz</span></span><br><span class="line">s_static(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应http请求数据</span></span><br><span class="line"><span class="keyword">with</span> s_block(<span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">    s_string(<span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#x27;</span>)</span><br><span class="line">    s_static(<span class="string">&#x27;&lt;soap:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;&#x27;</span>)</span><br><span class="line">    s_static(<span class="string">&#x27;&lt;soap:Body&gt;&#x27;</span>)</span><br><span class="line">    s_static(<span class="string">&#x27;&lt;Login xmlns=&quot;http://purenetworks.com/HNAP1/&quot;&gt;&#x27;</span>)</span><br><span class="line">    s_static(<span class="string">&#x27;&lt;Action&gt;&#x27;</span>)</span><br><span class="line">    s_string(<span class="string">&#x27;login&#x27;</span>, max_len=<span class="number">1024</span>)		<span class="comment"># 字段变异后的最大长度为1024</span></span><br><span class="line">    s_static(<span class="string">&#x27;&lt;/Action&gt;&#x27;</span>)</span><br><span class="line">    <span class="comment"># 省略部分内容</span></span><br><span class="line">    s_static(<span class="string">&#x27;&lt;/soap:Envelope&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>是否对某个字段进行fuzz需根据具体情况确定。对所有字段都fuzz，生成的畸形数据包会非常多，测试所耗费的时间比较长，但发现问题的可能性比较大；只对少部分字段进行fuzz，生成的畸形数据包会比较少，测试所耗费的时间更短，同时发现问题的可能性也比较小。</p><blockquote><p>字段的粒度大小可能也会对测试结果有所影响。比如，如果对<code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</code>进行变异，是将其当作一个整体，还是拆分为更小的单元?</p></blockquote><p>至于具体怎么对某个字段进行变异，如针对字符串的变异，该框架内已包含一些规则。当然，也可以自己增加规则。</p><p>类似的，对网络数据包中的其他<code>http</code>接口请求进行同样的定义。</p><blockquote><p>测试的接口越多，触发问题的可能性越大。</p></blockquote><h4 id="设置会话信息"><a href="#设置会话信息" class="headerlink" title="设置会话信息"></a>设置会话信息</h4><p>根据捕获的数据包定义完<code>请求</code>后，设置与<code>会话</code>相关的信息，包括目标设备的ip地址、端口等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">host = <span class="string">&#x27;192.168.2.1&#x27;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他参数可以按需设置，比如添加fuzz_loggers来保存测试用例和结果等</span></span><br><span class="line">session = Session(session_filename=<span class="string">&#x27;http_session&#x27;</span>, receive_data_after_fuzz=<span class="literal">True</span>, ignore_connection_reset=<span class="literal">True</span>, restart_sleep_time=<span class="number">10</span>)</span><br><span class="line">target = Target(</span><br><span class="line">    connection=SocketConnection(host, port, proto=<span class="string">&#x27;tcp&#x27;</span>),</span><br><span class="line">    netmon=Remote_NetworkMonitor(host, port, proto=<span class="string">&#x27;tcp&#x27;</span>))  <span class="comment"># 服务可用性监控</span></span><br><span class="line"></span><br><span class="line">session.add_target(target)</span><br></pre></td></tr></table></figure><p>然后将之前定义的<code>请求</code>按照一定的先后顺序链接起来，部分示例如下。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session.connect(s_get(<span class="string">&#x27;login&#x27;</span>))		<span class="comment"># 默认前置节点为root</span></span><br><span class="line">session.connect(s_get(<span class="string">&#x27;login&#x27;</span>), s_get(<span class="string">&#x27;setsysemailsettings&#x27;</span>), callback=add_auth_callback)</span><br><span class="line">session.connect(s_get(<span class="string">&#x27;login&#x27;</span>),s_get(<span class="string">&#x27;setsyslogsettings&#x27;</span>), callback=add_auth_callback)</span><br><span class="line">session.connect(s_get(<span class="string">&#x27;login&#x27;</span>),s_get(<span class="string">&#x27;setschedulesettings&#x27;</span>), callback=add_auth_callback)</span><br></pre></td></tr></table></figure><p>其中，由于<code>setsysemailsettings</code>、<code>setsyslogsettings</code>、<code>setschedulesettings</code>等请求需要在登录之后才可以正常使用，所以需要在<code>login</code>请求之后发生。而<code>setsysemailsettings</code>、<code>setsyslogsettings</code>和<code>setschedulesettings</code>这几个请求之间则没有明确的先后关系。<code>add_auth_callback</code>为自定义的回调函数，主要用于从<code>login</code>请求中获取用于登录认证的信息如<code>cookie</code>，然后将其设置于<code>setsysemailsettings</code>、<code>setsyslogsettings</code>、<code>setschedulesettings</code>等请求中。</p><img data-src="images/session_graph_example.png" style="zoom:70%"><h4 id="添加对目标设备的监控"><a href="#添加对目标设备的监控" class="headerlink" title="添加对目标设备的监控"></a>添加对目标设备的监控</h4><p>这里通过设备<code>HTTP</code>服务的可用性来判断目标设备是否发生异常。如果<code>HTTP</code>服务无法访问，说明设备可能崩溃了。前面设置的<code>Remote_NetworkMonitor()</code>就是用于对服务的可用性进行监测，其核心代码如下。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过TCP全连接来判断目标端口是否在监听</span></span><br><span class="line"><span class="keyword">if</span> self.proto == <span class="string">&quot;tcp&quot;</span> <span class="keyword">or</span> self.proto == <span class="string">&quot;ssl&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self._sock.connect((self.host, self.port))</span><br><span class="line">        self.alive_flag = <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">   		self.alive_flag = <span class="number">0</span></span><br></pre></td></tr></table></figure><blockquote><p><code>Remote_NetworkMonitor()</code>为自行添加的代码，不属于<code>Boofuzz</code>框架。</p></blockquote><p>前面也提到过，该监测方式的粒度比较粗，可能会存在漏报，可以采用或结合一些其他的方式进行改进。</p><ul><li>如果可能，在测试时对设备内部的输出日志进行记录，比如设备打印的一些输出信息；</li><li>如果可能，在gdb调试状态下进行测试。</li></ul><p>至于对环境进行恢复，由于该设备崩溃后会自行重启，所以无须额外的操作，只需调用<code>sleep()</code>等待设备重启后即可。</p><h4 id="开始fuzz"><a href="#开始fuzz" class="headerlink" title="开始fuzz"></a>开始fuzz</h4><p>最后调用<code>session.fuzz()</code>驱动整个过程，然后运行脚本即可。默认情况下，会在26000端口开启一个web服务，用于控制或查看测试的进度及相关信息等。在测试完成后，可以通过查看测试记录，看是否有测试用例造成目标设备出现异常，以进行进一步分析。</p><img data-src="images/boofuzz_webinterface.png" style="zoom:80%"><blockquote><p>笔者目前尚未对使用的<code>Boofuzz</code>框架进行更新。在最新的commit中，对web界面进行了改进，显示的信息更丰富。</p></blockquote><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>本文以<code>IoT</code>设备为例，对模糊测试框架<code>Boofuzz</code>，以及利用该框架对网络协议进行fuzz的基本流程进行了简要介绍。如果想要获得更好的效果，还需要对其中的细节进行进一步的优化与完善。</p><h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p0cGVyZXlkYS9ib29mdXp6">boofuzz: Network Protocol Fuzzing for Humans<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL2RvY3BsYXllci5uZXQvNDI5NDc1MjYtRnV6emluZy1zdWNrcy1pbnRyb2R1Y2luZy1zdWxsZXktZnV6emluZy1mcmFtZXdvcmstcGVkcmFtLWFtaW5pLTEtYWFyb24tcG9ydG5veS0yLWJsYWNrLWhhdC11cy0yMDA3Lmh0bWw=">Fuzzing Sucks! Introducing Sulley Fuzzing Framework<i class="fa fa-external-link-alt"></i></span></li></ul><br><blockquote><p>本文首发于信安之路，文章链接：<span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvNWd3SnBxajd5c3VlMTlPY29QSTE2QQ==">https://mp.weixin.qq.com/s/5gwJpqj7ysue19OcoPI16A<i class="fa fa-external-link-alt"></i></span></p></blockquote></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2019/03/18/D-Link-DIR-850L%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%86%E6%9E%90%E4%B9%8B%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87shell/" rel="prev" title="D-Link DIR-850L路由器分析之获取设备shell"><i class="fa fa-chevron-left"></i> D-Link DIR-850L路由器分析之获取设备shell</a></div><div class="post-nav-item"><a href="/2019/05/12/htib2017-pwn-%E4%B9%8B-1000levels/" rel="next" title="htib2017 pwn 之 1000levels">htib2017 pwn 之 1000levels <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E7%AE%80%E4%BB%8B"><span class="nav-number">2.</span> <span class="nav-text">模糊测试简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Boofuzz%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span class="nav-number">3.</span> <span class="nav-text">Boofuzz框架简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AEfuzz%E5%AE%9E%E6%88%98"><span class="nav-number">4.</span> <span class="nav-text">协议fuzz实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%8C%85%E6%9E%84%E9%80%A0%E8%AF%B7%E6%B1%82"><span class="nav-number">4.1.</span> <span class="nav-text">根据网络数据包构造请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%BC%9A%E8%AF%9D%E4%BF%A1%E6%81%AF"><span class="nav-number">4.2.</span> <span class="nav-text">设置会话信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%AF%B9%E7%9B%AE%E6%A0%87%E8%AE%BE%E5%A4%87%E7%9A%84%E7%9B%91%E6%8E%A7"><span class="nav-number">4.3.</span> <span class="nav-text">添加对目标设备的监控</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%A7%8Bfuzz"><span class="nav-number">4.4.</span> <span class="nav-text">开始fuzz</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5"><span class="nav-number">6.</span> <span class="nav-text">相关链接</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="cq674350529" src="/uploads/avatar_64.jpg"><p class="site-author-name" itemprop="name">cq674350529</p><div class="site-description" itemprop="description">Talk is cheap. Show me the code.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NxNjc0MzUwNTI5" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cq674350529"><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOmNxNjc0MzUwNTI5QDE2My5jb20=" title="E-Mail → mailto:cq674350529@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9jcTY3NDM1MDUyOQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;cq674350529"><i class="fab fa-twitter fa-fw"></i>Twitter</span> </span><span class="links-of-author-item"><a href="https://cq674350529.github.io/atom.xml" title="RSS → https:&#x2F;&#x2F;cq674350529.github.io&#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 推荐</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cDovL3d3dy5kZXZ0dHlzMC5jb20vYmxvZy8=" title="http:&#x2F;&#x2F;www.devttys0.com&#x2F;blog&#x2F;">/dev/ttyS0</span></li><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly9hemVyaWEtbGFicy5jb20vd3JpdGluZy1hcm0tYXNzZW1ibHktcGFydC0xLw==" title="https:&#x2F;&#x2F;azeria-labs.com&#x2F;writing-arm-assembly-part-1&#x2F;">Azeria Labs</span></li><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly9vbGQubGl2ZW92ZXJmbG93LmNvbS9pbmRleC5odG1s" title="https:&#x2F;&#x2F;old.liveoverflow.com&#x2F;index.html">LiveOverflow</span></li><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly9zY3JpcHRpbmd4c3MuZ2l0Ym9vay5pby9maXJtd2FyZS1zZWN1cml0eS10ZXN0aW5nLW1ldGhvZG9sb2d5Lw==" title="https:&#x2F;&#x2F;scriptingxss.gitbook.io&#x2F;firmware-security-testing-methodology&#x2F;">OWASP FSTM</span></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">cq674350529</span></div><script>(function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"rmMxusPPlEafDgjvi8lBiuOB-MdYXbMMI","app_key":"nN8G8UGTqCQXFaBR6GajW5hD","server_url":null,"security":false,"betterPerformance":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@2.1.6/source/jquery.fancybox.pack.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'rmMxusPPlEafDgjvi8lBiuOB-MdYXbMMI',
      appKey     : 'nN8G8UGTqCQXFaBR6GajW5hD',
      placeholder: ":)填上邮箱可以收到回复邮件",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>